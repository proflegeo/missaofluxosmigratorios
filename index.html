<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Protocolo M.I.G.R.A.√á.√É.O.</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #030305; --cyan: #00f3ff; --cyan-dim: rgba(0, 243, 255, 0.2);
            --green: #0aff0a; --red: #ff003c; --purple: #bd00ff; 
            --yellow: #f8e71c; --panel: #0d0d10;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { 
            background: var(--bg); color: #e0e0e0; font-family: 'JetBrains Mono', monospace; 
            margin: 0; height: 100dvh; display: flex; justify-content: center; overflow: hidden; 
            background-image: radial-gradient(circle at center, #111 0%, #000 100%);
        }

        #game { width: 100%; max-width: 600px; height: 100%; padding: 15px; display: flex; flex-direction: column; gap: 15px; position: relative; z-index: 2; }
        
        body::after {
            content: " "; display: block; position: absolute; top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 100; background-size: 100% 2px, 3px 100%; pointer-events: none;
        }

        .hud { 
            display: flex; justify-content: space-between; align-items: center; 
            background: var(--panel); border: 1px solid #333; padding: 10px 15px; 
            border-radius: 8px; font-size: 0.9rem; box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .hud-left { display: flex; align-items: center; gap: 10px; }
        .hud-right { display: flex; align-items: center; gap: 15px; } 
        .hud-btn { 
            background: transparent; border: 1px solid var(--purple); color: var(--purple); 
            padding: 6px 12px; border-radius: 4px; font-size: 0.7rem; font-weight: bold;
            cursor: pointer; text-transform: uppercase; transition: 0.2s; font-family: inherit;
        }
        .hud-btn:active { background: var(--purple); color: #fff; }
        
        .prog-box { width: 100%; height: 6px; background: #222; border-radius: 3px; overflow: hidden; border: 1px solid #333; }
        .prog-bar { height: 100%; background: var(--green); width: 0%; transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 0 10px var(--green); }

        .screen { 
            background: rgba(10, 10, 12, 0.8); border: 1px solid #333;
            border-top: 2px solid var(--purple); border-bottom: 2px solid var(--purple); 
            padding: 20px; flex-grow: 1; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; text-align: center; 
            border-radius: 12px; position: relative; box-shadow: inset 0 0 30px rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }
        .def { 
            font-size: 1.3rem; line-height: 1.6; font-weight: 500; color: #fff;
            text-shadow: 0 0 5px rgba(255,255,255,0.3); min-height: 60px;
            white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word;
        }
        @media (max-width: 380px) { .def { font-size: 1.1rem; } }
        .def::after { content: '‚ñà'; animation: blink 1s steps(2) infinite; color: var(--cyan); font-size: 1.2rem; margin-left: 5px; opacity: 0.8; }
        .hint { 
            color: var(--yellow); background: rgba(248, 231, 28, 0.1); border: 1px solid var(--yellow); border-radius: 6px;
            margin-top: 15px; font-size: 0.95rem; padding: 10px; display: none; width: 100%; 
        }
        .show { display: block; animation: fadeIn 0.5s; }

        .controls { 
            display: flex; flex-direction: column; gap: 12px; 
            padding-bottom: env(safe-area-inset-bottom); background: var(--panel); 
            padding: 15px; border-radius: 12px; border: 1px solid #333;
        }
        
        .input-wrapper { position: relative; width: 100%; min-height: 40px; display: flex; justify-content: center; }
        
        input { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            opacity: 0; z-index: 10; cursor: text; font-size: 16px; 
            color: transparent; background: transparent; border: none; outline: none; caret-color: transparent;
        }

        /* --- CORRE√á√ÉO DA QUEBRA DE LINHA --- */
        #boxes-container {
            display: flex; flex-wrap: wrap; gap: 10px; /* Gap maior entre palavras */
            justify-content: center; width: 100%; pointer-events: none;
            align-content: center;
        }
        /* Agrupa letras de uma palavra para n√£o quebrar no meio */
        .word-group {
            display: flex; gap: 4px; /* Gap entre letras */
        }

        .char-box {
            width: 26px; height: 36px; background: #000; border: 1px solid #444; border-bottom: 2px solid #555;
            border-radius: 4px; color: var(--cyan); font-size: 1.1rem; font-weight: bold;
            display: flex; align-items: center; justify-content: center; text-transform: uppercase;
            transition: 0.2s;
        }
        .char-box.filled { border-color: var(--cyan); background: rgba(0, 243, 255, 0.05); }
        .char-box.active { border-color: var(--green); box-shadow: 0 0 10px rgba(10, 255, 10, 0.3); transform: translateY(-2px); }
        
        @media (max-width: 400px) {
            .char-box { width: 20px; height: 28px; font-size: 0.9rem; border-radius: 3px; border-bottom-width: 1px; }
            .word-group { gap: 2px; }
            #boxes-container { gap: 6px; }
        }
        .input-error .char-box { animation: shake 0.4s; border-color: var(--red) !important; }

        .btns { display: flex; gap: 10px; }
        button.action { 
            padding: 15px; flex: 1; border: none; border-radius: 6px; 
            font-weight: bold; font-size: 1rem; cursor: pointer; font-family: inherit;
            text-transform: uppercase; position: relative; overflow: hidden; transition: transform 0.1s;
        }
        button.action:active { transform: scale(0.98); }
        .btn-ok { background: var(--cyan); color: #000; flex: 1.5; box-shadow: 0 0 10px var(--cyan-dim); }
        .btn-func { background: #222; color: #aaa; border: 1px solid #444; flex: 1; font-size: 0.8rem; }
        .btn-func:disabled { opacity: 0.5; cursor: not-allowed; border-color: #333; color: #555; }

        .msg { text-align: center; height: 25px; font-weight: bold; font-size: 1rem; margin-top: -5px; text-shadow: 0 0 5px currentColor; }

        .overlay { 
            position: fixed; inset: 0; background: rgba(5, 5, 5, 0.95); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 200; text-align: center; padding: 20px;
        }
        .hidden { display: none !important; }
        .btn-start { 
            background: transparent; color: var(--green); padding: 20px 60px; 
            font-size: 1.4rem; border: 2px solid var(--green); border-radius: 50px; 
            margin-top: 30px; font-weight: bold; cursor: pointer; font-family: inherit; 
            text-transform: uppercase; letter-spacing: 2px; 
            box-shadow: 0 0 15px rgba(10, 255, 10, 0.2); transition: 0.3s;
        }
        .btn-start:hover { background: var(--green); color: #000; box-shadow: 0 0 30px rgba(10, 255, 10, 0.6); }

        .report-grid { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 400px; 
            margin-bottom: 20px; text-align: left; background: var(--panel); padding: 20px; 
            border: 1px solid #333; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .r-item { display: flex; flex-direction: column; gap: 5px; }
        .r-label { font-size: 0.75rem; color: #666; text-transform: uppercase; letter-spacing: 1px; }
        .r-val { font-size: 1.2rem; color: #fff; font-weight: bold; }
        .site-link { 
            margin-top: 25px; color: var(--cyan); text-decoration: none; border: 1px solid var(--cyan); 
            padding: 10px 20px; border-radius: 30px; font-size: 0.9rem; transition: 0.3s; display: inline-block;
        }
        .site-link:hover { background: var(--cyan-dim); }

        #mg-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 40; display: none; border-radius: 12px; cursor: col-resize; }
        .mg-overlay { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fff; 
            text-align: center; width: 100%; pointer-events: none; z-index: 41; text-shadow: 0 2px 4px #000; 
            background: rgba(0,0,0,0.85); padding: 20px; border-radius: 12px; border: 1px solid var(--purple);
        }
        .author-mark {
            position: fixed; bottom: 5px; right: 8px; font-size: 0.6rem; color: var(--cyan); 
            opacity: 0.4; z-index: 1000; pointer-events: none; text-transform: uppercase; 
            letter-spacing: 1px; font-weight: bold; text-shadow: 0 0 2px var(--cyan);
        }

        @keyframes blink { 50% { opacity: 0; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
        
        h1 { position: relative; }
        h1::before, h1::after { content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.8; }
        h1::before { color: var(--red); z-index: -1; animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) both infinite; }
        h1::after { color: var(--cyan); z-index: -2; animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) reverse both infinite; }
        @keyframes glitch { 0% { transform: translate(0) } 20% { transform: translate(-2px, 2px) } 40% { transform: translate(-2px, -2px) } 60% { transform: translate(2px, 2px) } 80% { transform: translate(2px, -2px) } 100% { transform: translate(0) } }
    </style>
</head>
<body>

    <div class="author-mark">DEV: PROF. LEGEO</div>

    <div id="game">
        <div class="hud">
            <div class="hud-left">
                <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span> 
                <button class="hud-btn" onclick="init()">REINICIAR</button>
            </div>
            <div class="hud-right">
                <span id="hints-txt" style="color:var(--yellow)">üí° x3</span>
                <span id="skips-txt" style="color:var(--cyan)">‚è≠Ô∏è x5</span>
            </div>
        </div>

        <div class="prog-box"><div class="prog-bar" id="prog-bar"></div></div>
        
        <div class="screen">
            <div class="def" id="q"></div>
            <div class="hint" id="h"></div>
            <canvas id="mg-canvas"></canvas>
            <div id="mg-msg" class="mg-overlay hidden">
                <h2 style="color:var(--yellow)">ALERTA DE B√îNUS</h2>
                <p>Arraste para mover a nave.</p>
                <p>Pegue <span style="color:var(--green)">VERDE</span>. Evite <span style="color:var(--red)">VERMELHO</span>.</p>
                <p style="font-size:0.8rem; margin-top:10px;">Colete 5 para ganhar +1 Vida!</p>
            </div>
        </div>

        <div class="msg" id="msg"></div>

        <div class="controls">
            <div class="input-wrapper" id="input-wrapper">
                <input type="text" id="ans" autocomplete="off" autocorrect="off" spellcheck="false">
                <div id="boxes-container"></div>
            </div>

            <div class="btns">
                <button class="action btn-ok" onclick="check()">ENVIAR</button>
                <button class="action btn-func" onclick="tip()" id="btn-hint">DICA</button>
                <button class="action btn-func" onclick="skip()" id="btn-skip">PULAR</button>
            </div>
        </div>
    </div>

    <div id="start" class="overlay">
        <h1 style="color:var(--cyan); margin-bottom: 10px;" data-text="M.I.G.R.A.√á.√É.O.">M.I.G.R.A.√á.√É.O.</h1>
        <p style="color: #aaa; font-size: 0.9rem;">Restaurar sistema de navega√ß√£o.</p>
        <button class="btn-start" onclick="init()">INICIAR</button>
    </div>

    <script>
        const db = [
            { t: "Migra√ß√£o", d: "Termo geral para qualquer deslocamento de pessoas pelo espa√ßo geogr√°fico.", h: "Defini√ß√£o geral de mudar de lugar." },
            { t: "Emigra√ß√£o", d: "Ato de SAIR do seu local de origem para viver em outro lugar.", h: "Exit / Sa√≠da." },
            { t: "Imigra√ß√£o", d: "Ato de CHEGAR e entrar em um novo local para viver.", h: "In / Entrada." },
            { t: "Migra√ß√£o interna", d: "Deslocamento de pessoas dentro das fronteiras de um mesmo pa√≠s.", h: "N√£o sai do pa√≠s." },
            { t: "Migra√ß√£o internacional", d: "Deslocamento de pessoas entre pa√≠ses diferentes.", h: "Entre na√ß√µes." },
            { t: "Migra√ß√£o pendular", d: "Movimento di√°rio de vai e vem (casa-trabalho).", h: "Como um p√™ndulo." },
            { t: "Migra√ß√£o sazonal", d: "Deslocamento ligado apenas a esta√ß√µes do ano ou colheitas.", h: "Tempor√°rio por esta√ß√£o." },
            { t: "Transum√¢ncia", d: "Migra√ß√£o sazonal ligada √† cria√ß√£o de gado ou colheitas.", h: "Pastores e gado." },
            { t: "√äxodo Rural", d: "Migra√ß√£o em massa do campo para a cidade.", h: "Sa√≠da do campo." },
            { t: "Migra√ß√£o urbano-urbano", d: "Mudan√ßa de uma cidade para outra cidade.", h: "Entre zonas urbanas." },
            { t: "Migra√ß√£o de retorno", d: "A volta do migrante para sua terra natal.", h: "O bom filho √† casa torna." },
            { t: "Di√°spora", d: "Dispers√£o de um povo pelo mundo mantendo identidade cultural.", h: "Ex: Judeus ou Africanos." },
            { t: "Fuga de c√©rebros", d: "Sa√≠da de profissionais altamente qualificados para pa√≠ses ricos.", h: "Perda de cientistas." },
            { t: "Refugiado", d: "Pessoa que fugiu por persegui√ß√£o (ra√ßa, religi√£o, pol√≠tica).", h: "Protegido pela ONU." },
            { t: "Asilo", d: "Prote√ß√£o jur√≠dica pedida a outro governo por persegui√ß√£o pol√≠tica.", h: "Prote√ß√£o pol√≠tica." },
            { t: "Deslocados internos", d: "Fugitivos de conflitos que n√£o cruzaram fronteiras internacionais.", h: "Refugiado dentro do pr√≥prio pa√≠s." },
            { t: "Ap√°trida", d: "Pessoa sem nacionalidade reconhecida por nenhum pa√≠s.", h: "Sem p√°tria." },
            { t: "Xenofobia", d: "Avers√£o, √≥dio ou preconceito contra estrangeiros.", h: "Medo do estrangeiro." },
            { t: "Coiote", d: "Atravessador pago para guiar imigrantes ilegais.", h: "Guia ilegal na fronteira." },
            { t: "Deportar", d: "Ato do Estado de enviar for√ßadamente estrangeiro de volta.", h: "Expuls√£o legal." },
            { t: "Naturaliza√ß√£o", d: "Processo jur√≠dico para adquirir nacionalidade de outro pa√≠s.", h: "Tornar-se cidad√£o." },
            { t: "Visto", d: "Autoriza√ß√£o no passaporte para entrar em um pa√≠s.", h: "Carimbo consular." },
            { t: "Passaporte", d: "Documento oficial de identidade para viagens internacionais.", h: "Documento de viagem." },
            { t: "Fronteira", d: "Linha imagin√°ria ou f√≠sica que separa dois pa√≠ses ou estados.", h: "Divisa internacional." },
            { t: "Tr√°fico humano", d: "Recrutamento enganoso/for√ßado de pessoas para explora√ß√£o.", h: "Crime contra a liberdade." },
            { t: "ACNUR", d: "Ag√™ncia da ONU para refugiados.", h: "Sigla da ONU." },
            { t: "Campo de refugiados", d: "Assentamento tempor√°rio para receber pessoas fugindo de guerras.", h: "Abrigo provis√≥rio da ONU." },
            { t: "Remessas financeiras", d: "Dinheiro enviado por trabalhadores no exterior para a fam√≠lia.", h: "Envio de d√≥lares para casa." },
            { t: "Assimila√ß√£o cultural", d: "Quando o imigrante perde sua cultura original e adota a local.", h: "Perda de identidade." },
            { t: "Multiculturalismo", d: "Coexist√™ncia de diversas culturas no mesmo territ√≥rio.", h: "V√°rias culturas juntas." },
            { t: "Segrega√ß√£o", d: "Separa√ß√£o f√≠sica ou social de grupos humanos.", h: "Apartheid √© um exemplo." },
            { t: "Gueto", d: "√Årea de uma cidade onde vive uma minoria √©tnica ou social.", h: "Bairro isolado." },
            { t: "Enclave √©tnico", d: "Pequeno territ√≥rio culturalmente distinto dentro de outro maior.", h: "Ex: Chinatown." },
            { t: "Cidadania", d: "Conjunto de direitos e deveres de um indiv√≠duo em um Estado.", h: "Direito de pertencer." },
            { t: "Dupla cidadania", d: "Possuir nacionalidade de dois pa√≠ses ao mesmo tempo.", h: "Dois passaportes." },
            { t: "Imigrante ilegal", d: "Pessoa que entra ou vive em um pa√≠s sem autoriza√ß√£o oficial.", h: "Indocumentado." },
            { t: "Anistia", d: "Perd√£o oficial do governo para regularizar imigrantes ilegais.", h: "Perd√£o." },
            { t: "Espa√ßo Schengen", d: "√Årea na Europa de livre circula√ß√£o de pessoas sem fronteiras.", h: "Livre circula√ß√£o na UE." },
            { t: "Green Card", d: "Visto de resid√™ncia permanente nos Estados Unidos.", h: "Cart√£o verde dos EUA." },
            { t: "Fatores de atra√ß√£o", d: "Motivos positivos que puxam o migrante (ex: emprego).", h: "O que atrai." },
            { t: "Fatores de repuls√£o", d: "Motivos negativos que empurram a pessoa para fora (ex: guerra).", h: "O que expulsa." },
            { t: "Globaliza√ß√£o", d: "Processo de integra√ß√£o econ√¥mica e cultural mundial.", h: "Mundo interligado." },
            { t: "Demografia", d: "Ci√™ncia que estuda a din√¢mica das popula√ß√µes humanas.", h: "Estudo da popula√ß√£o." },
            { t: "Censo", d: "Pesquisa oficial do governo para contar a popula√ß√£o.", h: "IBGE faz a cada 10 anos." },
            { t: "Saldo migrat√≥rio", d: "Diferen√ßa entre n√∫mero de imigrantes e emigrantes.", h: "Conta: Entradas - Sa√≠das." },
            { t: "Crescimento vegetativo", d: "Diferen√ßa entre nascimentos e mortes.", h: "Crescimento natural." },
            { t: "Cidade dormit√≥rio", d: "Cidade onde a popula√ß√£o dorme mas trabalha na vizinha.", h: "Serve apenas para resid√™ncia." },
            { t: "N√¥made digital", d: "Profissional que usa internet para trabalhar viajando.", h: "Trabalho remoto pelo mundo." },
            { t: "Expatriado", d: "Profissional transferido pela empresa para outro pa√≠s.", h: "Executivo internacional." },
            { t: "Migra√ß√£o intermunicipal", d: "Mudan√ßa de resid√™ncia de uma cidade para outra.", h: "Entre munic√≠pios." }
        ];

        let st = { 
            q: [], c: null, lives: 5, hints: 3, skips: 5, 
            score: 0, errors: 0, streak: 0, maxStreak: 0, 
            startTime: 0, events: new Set() 
        };
        let typeInterval;

        function init() {
            st.q = [...db].sort(() => Math.random() - 0.5); 
            st.lives = 5; st.hints = 3; st.skips = 5;
            st.score = 0; st.errors = 0; st.streak = 0; st.maxStreak = 0;
            st.events.clear();
            st.startTime = Date.now();
            
            document.getElementById('start').classList.add('hidden');
            updateHUD();
            document.getElementById('prog-bar').style.width = "0%";
            next();
        }

        function norm(str) {
            return str.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim();
        }

        function typeWriter(text) {
            const el = document.getElementById('q');
            el.innerText = ""; clearInterval(typeInterval);
            let i = 0;
            typeInterval = setInterval(() => {
                el.innerText += text.charAt(i); i++;
                if (i >= text.length) clearInterval(typeInterval);
            }, 25);
        }

        function next() {
            // Verifica Mini Game (dispara no acerto 10, 20, 30...)
            if (st.score > 0 && st.score % 10 === 0 && !st.events.has(st.score)) {
                st.events.add(st.score);
                startMiniGame();
                return;
            }

            if (!st.q.length || st.lives <= 0) return end();
            
            st.c = st.q.shift(); 
            typeWriter(st.c.d);

            document.getElementById('h').classList.remove('show');
            document.getElementById('msg').innerText = '';
            
            const input = document.getElementById('ans');
            input.value = '';
            input.setAttribute('maxlength', st.c.t.length); 
            input.focus();
            renderBoxes(st.c.t);
        }

        // --- NOVA FUN√á√ÉO DE RENDERIZA√á√ÉO (AGRUPA POR PALAVRAS) ---
        function renderBoxes(answerText) {
            const container = document.getElementById('boxes-container');
            container.innerHTML = '';
            
            // Separa por palavras (respeitando espa√ßos)
            const words = answerText.split(' ');

            words.forEach((word, index) => {
                // Cria um grupo (div) para cada palavra
                const wordGroup = document.createElement('div');
                wordGroup.className = 'word-group';

                for (let char of word) {
                    if (char === '-') {
                        let dash = document.createElement('div');
                        dash.className = 'char-box filled';
                        dash.innerText = '-';
                        wordGroup.appendChild(dash);
                    } else {
                        let box = document.createElement('div');
                        box.className = 'char-box';
                        wordGroup.appendChild(box);
                    }
                }
                
                container.appendChild(wordGroup);
            });
        }

        // L√≥gica de preenchimento visual ajustada para ignorar espa√ßos no input
        document.getElementById('ans').addEventListener('input', function() {
            // Remove espa√ßos do que foi digitado para bater com as caixinhas (que n√£o t√™m espa√ßo)
            const val = this.value.replace(/\s/g, ''); 
            
            const allBoxes = document.querySelectorAll('.char-box'); 
            
            // Limpa tudo primeiro
            allBoxes.forEach(b => { 
                if(b.innerText !== '-') { 
                    b.innerText = ''; 
                    b.classList.remove('filled', 'active'); 
                } 
            });

            let valIndex = 0;
            allBoxes.forEach((box) => {
                if (box.innerText === '-') return; // Pula h√≠fens
                
                if (valIndex < val.length) {
                    box.innerText = val[valIndex];
                    box.classList.add('filled');
                    // Efeito de destaque na √∫ltima letra digitada
                    if (valIndex === val.length - 1) box.classList.add('active'); 
                    valIndex++;
                }
            });
        });

        function check() {
            let inputRaw = document.getElementById('ans').value;
            if (!inputRaw || inputRaw.replace(/[^a-zA-Z0-9]/g, '').length === 0) {
                document.getElementById('boxes-container').classList.add('input-error');
                setTimeout(() => document.getElementById('boxes-container').classList.remove('input-error'), 400);
                return;
            }

            let v = norm(inputRaw);
            let r = norm(st.c.t);
            let alt = st.c.a ? st.c.a.map(norm) : [];

            const msgEl = document.getElementById('msg');

            if (v === r || alt.includes(v)) {
                st.score++; st.streak++;
                if (st.streak > st.maxStreak) st.maxStreak = st.streak;
                
                msgEl.innerText = "‚úÖ CORRETO!";
                msgEl.style.color = "var(--green)";
                updateProgress();
                setTimeout(next, 1000);
            } else {
                st.lives--; st.errors++; st.streak = 0;
                msgEl.innerText = "‚ùå ERA: " + st.c.t.toUpperCase();
                msgEl.style.color = "var(--red)";
                
                st.q.push(st.c); 
                
                updateHUD();
                setTimeout(next, 2500);
            }
        }

        function skip() {
            if (st.skips > 0) {
                st.skips--;
                st.q.push(st.c);
                document.getElementById('msg').innerText = "‚è≠Ô∏è PULOU";
                document.getElementById('msg').style.color = "var(--cyan)";
                updateHUD();
                setTimeout(next, 500);
            }
        }

        function tip() {
            if (st.hints > 0) {
                st.hints--;
                document.getElementById('h').innerText = "üí° " + st.c.h;
                document.getElementById('h').classList.add('show');
                updateHUD();
            }
        }

        function updateHUD() {
            document.getElementById('lives').innerText = "‚ù§Ô∏è".repeat(st.lives);
            document.getElementById('hints-txt').innerText = "üí° x" + st.hints;
            document.getElementById('skips-txt').innerText = "‚è≠Ô∏è x" + st.skips;
            document.getElementById('btn-hint').disabled = st.hints <= 0;
            document.getElementById('btn-skip').disabled = st.skips <= 0;
        }

        function updateProgress() {
            let pct = Math.min((st.score / 50) * 100, 100);
            document.getElementById('prog-bar').style.width = pct + "%";
        }

        // --- MINI GAME SYSTEM ---
        let mg = { active: false, x: 0, items: [], score: 0, ctx: null, w: 0, h: 0, mode: 0 };
        
        function startMiniGame() {
            mg.active = true; mg.score = 0; mg.items = [];
            mg.mode = Math.floor(Math.random() * 3);
            let modeName = ["CL√ÅSSICO", "CHUVA DE V√çRUS", "TURBO"][mg.mode];
            let modeColor = ["var(--green)", "var(--red)", "var(--yellow)"][mg.mode];

            const cvs = document.getElementById('mg-canvas');
            const msg = document.getElementById('mg-msg');
            
            msg.innerHTML = `
                <h2 style="color:var(--yellow)">ALERTA DE B√îNUS</h2>
                <p style="font-size:1.2rem; color:${modeColor}; font-weight:bold; margin: 10px 0;">MODO: ${modeName}</p>
                <p>Colete 10 VERDES para ganhar +1 Vida!</p>
                <p style="font-size:0.8rem; margin-top:10px;">Arraste a nave</p>
            `;
            
            cvs.style.display = 'block'; msg.classList.remove('hidden');
            mg.ctx = cvs.getContext('2d');
            mg.w = cvs.width = cvs.offsetWidth;
            mg.h = cvs.height = cvs.offsetHeight;
            mg.x = mg.w / 2;

            setTimeout(() => {
                msg.classList.add('hidden');
                loopMiniGame();
                spawnItem();
            }, 3000);
        }

        function spawnItem() {
            if (!mg.active) return;
            let badChance = 0.3; let speedBase = 3; let spawnRate = 700;
            if (mg.mode === 1) { badChance = 0.6; spawnRate = 500; }
            if (mg.mode === 2) { speedBase = 6; spawnRate = 400; }

            let type = Math.random() > (1 - badChance) ? 'bad' : 'good';
            mg.items.push({ 
                x: Math.random() * (mg.w - 20), y: -20, speed: speedBase + Math.random() * 3, type: type
            });
            if (mg.active) setTimeout(spawnItem, spawnRate);
        }

        function loopMiniGame() {
            if (!mg.active) return;
            mg.ctx.clearRect(0, 0, mg.w, mg.h);
            
            mg.ctx.fillStyle = '#00f3ff';
            mg.ctx.fillRect(mg.x - 20, mg.h - 30, 40, 10);
            mg.ctx.beginPath(); mg.ctx.moveTo(mg.x, mg.h-40); mg.ctx.lineTo(mg.x-10, mg.h-30); mg.ctx.lineTo(mg.x+10, mg.h-30); mg.ctx.fill();

            for (let i = 0; i < mg.items.length; i++) {
                let it = mg.items[i];
                it.y += it.speed;
                mg.ctx.fillStyle = it.type === 'good' ? '#0aff0a' : '#ff003c';
                mg.ctx.beginPath(); mg.ctx.arc(it.x, it.y, 8, 0, Math.PI*2); mg.ctx.fill();

                if (it.y > mg.h - 40 && it.y < mg.h - 10 && it.x > mg.x - 30 && it.x < mg.x + 30) {
                    if (it.type === 'good') mg.score++;
                    else { endMiniGame(false); return; }
                    mg.items.splice(i, 1); i--;
                } else if (it.y > mg.h) { mg.items.splice(i, 1); i--; }
            }

            mg.ctx.fillStyle = '#fff'; mg.ctx.font = '20px monospace';
            mg.ctx.fillText("COLETE: " + mg.score + "/10", 10, 30);

            if (mg.score >= 10) endMiniGame(true);
            else requestAnimationFrame(loopMiniGame);
        }

        function endMiniGame(win) {
            mg.active = false;
            const msg = document.getElementById('mg-msg');
            if (win) {
                msg.innerHTML = "<h2 style='color:var(--green)'>SUCESSO!</h2><p>+1 VIDA EXTRA</p>";
                st.lives++;
            } else {
                msg.innerHTML = "<h2 style='color:var(--red)'>FALHA!</h2><p>V√≠rus detectado!</p>";
            }
            msg.classList.remove('hidden');
            updateHUD();
            setTimeout(() => {
                document.getElementById('mg-canvas').style.display = 'none';
                msg.classList.add('hidden');
                next(); 
            }, 2500);
        }

        function moveShip(clientX) {
            if (!mg.active) return;
            const cvs = document.getElementById('mg-canvas');
            const rect = cvs.getBoundingClientRect();
            let newX = clientX - rect.left;
            if (newX < 20) newX = 20; if (newX > mg.w - 20) newX = mg.w - 20;
            mg.x = newX;
        }

        const cvs = document.getElementById('mg-canvas');
        cvs.addEventListener('touchmove', (e) => { e.preventDefault(); moveShip(e.touches[0].clientX); }, { passive: false });
        cvs.addEventListener('mousemove', (e) => { moveShip(e.clientX); });

        function end() {
            const time = Math.floor((Date.now() - st.startTime) / 1000);
            const m = Math.floor(time / 60).toString().padStart(2, '0');
            const s = (time % 60).toString().padStart(2, '0');
            const total = st.score + st.errors;
            const acc = total === 0 ? 0 : Math.round((st.score / total) * 100);
            const win = st.lives > 0;

            document.getElementById('start').classList.remove('hidden');
            document.getElementById('start').innerHTML = `
                <h1 style="color: ${win ? 'var(--green)' : 'var(--red)'}; font-size: 2rem;">
                    ${win ? 'MISS√ÉO CUMPRIDA' : 'FALHA NO SISTEMA'}
                </h1>
                <div class="report-grid">
                    <div class="r-item"><span class="r-label">Acertos</span><span class="r-val">${st.score}</span></div>
                    <div class="r-item"><span class="r-label">Erros</span><span class="r-val" style="color:var(--red)">${st.errors}</span></div>
                    <div class="r-item"><span class="r-label">Precis√£o</span><span class="r-val">${acc}%</span></div>
                    <div class="r-item"><span class="r-label">Tempo</span><span class="r-val">${m}:${s}</span></div>
                    <div class="r-item"><span class="r-label">Maior Combo</span><span class="r-val" style="color:var(--purple)">${st.maxStreak}</span></div>
                    <div class="r-item"><span class="r-label">Status</span><span class="r-val">${win ? 'RESGATADO' : 'PERDIDO'}</span></div>
                </div>
                <a href="https://www.legeo.com.br/" target="_blank" class="site-link">Mais conte√∫dos em legeo.com.br</a>
                <button class="btn-start" onclick="location.reload()">NOVA MISS√ÉO</button>
            `;
        }

        document.getElementById('ans').addEventListener("keypress", (e) => {
            if (e.key === "Enter") check();
        });
    </script>
</body>
</html>
